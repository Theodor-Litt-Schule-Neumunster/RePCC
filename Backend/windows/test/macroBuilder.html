<!--This is a very basic tool to make .pcmac files. It will not be included in the final product.-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Macrobuilder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<style>
    body{
        background-color: darkslategray;
        margin: 0;
    }

    #wrapper{
        display: flex;
        width: 100%;
        height: 100%;

        flex-direction: column;
    }

    .header{
        text-align: center;
        font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        font-size: 30pt;
        color: white;
        background-color: rgb(0, 0, 0);
        
        width: 100%;
    }

    #blocks{
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        row-gap: 10px;
        column-gap: 2px;
    }

    .block{
        background-color: black;
        min-width: 15%;
        min-height: 15%;
        aspect-ratio: 1/1;
        color: white;
        margin-left: auto;
        margin-right: auto;
    }
    .blockhighlight{
        background-color: white;
        color: black;
    }
</style>

<script>
    function addKeyboard(mode) {
        const blockArea = document.getElementById("blocks")

        if (mode === "singlekey") {
            const keyval = document.getElementById("singlekeyinput").value
            const sleepval = document.getElementById("singlekeysleep").value
            const pressval = document.getElementById("singlekeypresssleep").value

            id = blockArea.children.length + 1

            html = `
            <div class="block" id=block`+ id + `>
                <span class="blockhighlight">  `+ id + `</span> <span>keyboard</span> <br>
                <span>actiontype singlekey</span> <br>
                <span>actiondata [`+ keyval + `]</span> <br>
                <span>sleep `+ sleepval + `</span> <br>
                <span>presssleep `+ pressval + `</span>
            </div>
            `

            blockArea.innerHTML = blockArea.innerHTML + html
            keyboardBack()
        } if (mode === "multikey") {
            const keyval = document.getElementById("multikeyinput").value
            const sleepval = document.getElementById("multikeysleep").value
            const pressval = document.getElementById("multikeypresssleep").value

            id = blockArea.children.length + 1

            html = `
            <div class="block" id=block`+ id + `>
                <span class="blockhighlight">  `+ id + `</span> <span>keyboard</span> <br>
                <span>actiontype multikey</span> <br>
                <span>actiondata [`+ keyval + `]</span> <br>
                <span>sleep `+ sleepval + `</span> <br>
                <span>presssleep `+ pressval + `</span>
            </div>
            `

            blockArea.innerHTML = blockArea.innerHTML + html
            keyboardBack()
        }
    }

    function keyboardBack() {
        body = document.getElementById("keyboardmodalbody")

        body.innerHTML = `

        Select Keyboard mode
        <button onclick="keyboardModal_selectMode('singlekey')" type="button" class="btn btn-danger">Single Key</button> 
        <button onclick="keyboardModal_selectMode('multikey')" type="button" class="btn btn-danger">Multi Key</button>
      
        `
    }
    function keyboardModal_selectMode(mode) {
        body = document.getElementById("keyboardmodalbody")

        if (mode === "singlekey") {
            body.innerHTML = `
            
                key: <input type="text" name="singlekeyinput" id="singlekeyinput" placeholder="A"> for multiple, seperate with spaces (use space for space key)
                <br>press length in ms <input type="number" name="sleep" id="singlekeypresssleep" placeholder="100">
                <br>sleep in ms: <input type="number" name="sleep" id="singlekeysleep" placeholder="100">
                <br><br>
                <button type="button" class="btn btn-secondary" onclick="keyboardBack()">Back</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="addKeyboard('singlekey')">Add</button>

            `
        } if (mode === "multikey") {
            body.innerHTML = `
                keys: <input type="text" name="multikeyinput" id="multikeyinput" placeholder="CTRL ALT DELETE"> seperate keys with spaces (use &lt;space&gt; for space key)
                <br>press length in ms <input type="number" name="sleep" id="multikeypresssleep" placeholder="100">
                <br>sleep in ms: <input type="number" name="sleep" id="multikeysleep" placeholder="100">
                <br>
                <button type="button" class="btn btn-secondary" onclick="keyboardBack()">Back</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="addKeyboard('multikey')">Add</button>
            `
        }
    }

    function addMouse(mode) {
        const blockArea = document.getElementById("blocks")
        if (mode === "click") {
            const buttonval = document.getElementById("buttoninput").value
            const sleepval = document.getElementById("buttonsleepinput").value
            const pressval = document.getElementById("clicksleepinput").value

            id = blockArea.children.length + 1

            html = `
            <div class="block" id=block`+ id + `>
                <span class="blockhighlight">  `+ id + `</span> <span>mouse</span> <br>
                <span>actiontype click</span> <br>
                <span>actiondata [`+ buttonval + `]</span> <br>
                <span>sleep `+ sleepval + `</span> <br>
                <span>presssleep `+ pressval + `</span>
            </div>
            `

            blockArea.innerHTML = blockArea.innerHTML + html
            mouseBack()
        }
        if (mode === "move") {
            let x = document.getElementById("mousemovex").value
            let y = document.getElementById("mousemovey").value
            let sleep = document.getElementById("mousemovesleep").value
            let transition = document.getElementById("mousemovetransition").value
            let transitiontime = document.getElementById("mousemovetransitiontime").value

            id = blockArea.children.length + 1

            html = `
            <div class="block" id=block`+ id + `>
                <span class="blockhighlight">  `+ id + `</span> <span>mouse</span> <br>
                <span>actiontype move</span> <br>
                <span>actiondata [`+ x + `, `+ y + `]</span> <br>
                <span>sleep `+ sleep + `</span> <br>
                <span>transition `+ transition + `</span>
                <span>transitiontime `+ transitiontime + `</span>
            </div>
            `

            blockArea.innerHTML = blockArea.innerHTML + html
            mouseBack()
        }
    }

    function mouseBack() {
        body = document.getElementById("mousemodalbody")
        body.innerHTML = `  

        Select Mouse mode 
        <button onclick="mouseModal_selectMode('move')" type="button" class="btn btn-danger">Move</button> 
        <button onclick="mouseModal_selectMode('click')" type="button" class="btn btn-danger">Click</button>
        
        `
    }
    function mouseModal_selectMode(mode) {
        body = document.getElementById("mousemodalbody")
        if (mode === "click") {
            htmlbody = `
            
                button: <input type="number" name="clickbtn" id="buttoninput" min="0" max="1" placeholder="0"> (0 leftclick 1 rightclick)
                <br>press length in ms <input type="number" name="sleep" id="clicksleepinput" placeholder="100">
                <br>sleep in ms: <input type="number" name="sleep" id="buttonsleepinput" placeholder="100">
                <br><br>
                <button type="button" class="btn btn-secondary" onclick="mouseBack()">Back</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="addMouse('click')">Add</button>

            `

            body.innerHTML = htmlbody
        } if (mode === "move") {
            htmlbody = `
                x: <input type="number" name="mousemovex" id="mousemovex" style="max-width: 10%;" placeholder="0.5">
                y: <input type="number" name="mousemovey" id="mousemovey" style="max-width: 10%;" placeholder="0.5">
                coordinates are normalized. (0.0 - 1.0)

                <br>sleep <input type="number" name="mousemovesleep" id="mousemovesleep" placeholder="100">
                <br>transitiontime <input type="number" name="mousemovetransitiontime" id="mousemovetransitiontime" placeholder="100">
                <br>transition <select name="transitions" id="mousemovetransition">
                    <option value="quadratic">smooth</option>
                    <option value="linear">linear</option>
                </select>
                <br>
                <button type="button" class="btn btn-secondary" onclick="mouseBack()">Back</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="addMouse('move')">Add</button>
            `

            body.innerHTML = htmlbody
        }
    }

    function exportPCMAC() {
        const blockArea = document.getElementById("blocks")
        const blocks = blockArea.children
        const pcmacData = {}

        for (let i = 0; i < blocks.length; i++) {
            const block = blocks[i]
            const spans = block.querySelectorAll("span")
            const id = i + 1
            
            let type = ""
            let actiontype = ""
            let actiondata = []
            let sleep = 100
            let presssleep = 10
            let transition = ""
            let transitiontime = 0

            for (const span of spans) {
                const text = span.textContent.trim()
                
                if (text === "keyboard" || text === "mouse") {
                    type = text
                }
                if (text.startsWith("actiontype ")) {
                    actiontype = text.replace("actiontype ", "")
                }
                if (text.startsWith("actiondata [")) {
                    const dataStr = text.replace("actiondata [", "").replace("]", "")
                    if (dataStr.includes(",")) {
                        actiondata = dataStr.split(",").map(item => {
                            const trimmed = item.trim()
                            const num = parseFloat(trimmed)
                            return isNaN(num) ? trimmed : num
                        })
                    } else {
                        const trimmed = dataStr.trim()
                        const num = parseFloat(trimmed)
                        if (!isNaN(num)) {
                            actiondata = [num]
                        } else {
                            actiondata = []
                            const tokens = trimmed.split(" ")
                            for (let token of tokens) {
                                if (token === "space") {
                                    actiondata.push(" ")
                                } else if (token !== "") {
                                    actiondata.push(token)
                                }
                            }
                        }
                    }
                }
                if (text.startsWith("sleep ")) {
                    sleep = parseInt(text.replace("sleep ", ""))
                }
                if (text.startsWith("presssleep ")) {
                    presssleep = parseInt(text.replace("presssleep ", ""))
                }
                if (text.startsWith("transition ")) {
                    transition = text.replace("transition ", "")
                }
                if (text.startsWith("transitiontime ")) {
                    transitiontime = parseInt(text.replace("transitiontime ", ""))
                }
            }

            const blockData = {
                "type": type,
                "actiontype": actiontype,
                "actiondata": actiondata,
                "sleep": sleep,
                "presssleep": presssleep
            }

            if (type === "mouse" && actiontype === "move") {
                blockData["transition"] = transition
                blockData["transitiontime"] = transitiontime
                delete blockData.presssleep
            }

            pcmacData[id.toString()] = blockData
        }

        const jsonString = JSON.stringify(pcmacData, null, 4)
        const blob = new Blob([jsonString], { type: "application/json" })
        const url = URL.createObjectURL(blob)
        
        const a = document.createElement("a")
        a.href = url
        a.download = "macro.pcmac"
        document.body.appendChild(a)
        a.click()
        document.body.removeChild(a)
        URL.revokeObjectURL(url)
    }
</script>

<body>

    <div id="wrapper">
        <div class="header"> .PCMAC Builder </div>
        <div id="buildwrapper">
            <div id="controlpannel">

                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#mouseModal">Add Mouse</button>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#keyboardModal">Add Keyboard</button>
                <button onclick="exportPCMAC()">Export .pcmac</button>

            </div>

            <div id="blocks">
                <!-- <div class="block">
                    1 type <button>Delete</button> <br>
                    actiontype <br>
                    actiondata <br>
                    sleep 1 <br>
                    sleep 2
                </div> -->
            </div>
        </div>
    </div>


<div>
    <div class="modal fade" id="mouseModal" tabindex="-1" aria-labelledby="AddMouse" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
        <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Add Mouse Event</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div id="mousemodalbody">
                Select Mouse mode
                <button onclick="mouseModal_selectMode('move')" type="button" class="btn btn-danger">Move</button> 
                <button onclick="mouseModal_selectMode('click')" type="button" class="btn btn-danger">Click</button>
            </div>
        </div>
        </div>
    </div>
    </div>

    <div class="modal fade" id="keyboardModal" tabindex="-1" aria-labelledby="AddKeyboard" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
        <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Add Keyboard Event</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div id="keyboardmodalbody">
                Select Keyboard mode
                <button onclick="keyboardModal_selectMode('singlekey')" type="button" class="btn btn-danger">Single Key</button> 
                <button onclick="keyboardModal_selectMode('multikey')" type="button" class="btn btn-danger">Multi Key</button>
            </div>
        </div>
        </div>
    </div>
    </div>
</div>
    

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
</body>
</html>