<!-- This site is just to test the API calls. No functional use in the final product. -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    #informationDiv{
        text-align: center;
        background-color: #131313;
    }
    #laser-touchpad{
        background-color: azure;
        aspect-ratio: 16/9;
        max-width: 50%;
        max-height: 300px;

        margin-left: auto;
        margin-right: auto;
    }
</style>

<script>
    let successfulPing = false

    async function sendPing() {
        const infoHeader = document.getElementById("informationDiv")
        infoHeader.innerText = "Sending ping to http://127.0.0.1:15248/ping"
        console.log("sending ping to local adress")

        try {
            const response = await fetch("http://127.0.0.1:15248/ping")
            if (response.ok) {
                infoHeader.innerText = "Ping success."
                successfulPing = true
            } else {
                infoHeader.innerText = "Ping failed."
            }
        } catch (error) {
            infoHeader.innerText = "Full Error on Ping. Your request did not go through. Please check if the server is running."
        }
    }

    async function startLaser() {
        const infoHeader = document.getElementById("informationDiv")
        infoHeader.innerText = "Starting Pointer..."
        try {
            const response = await fetch("http://127.0.0.1:15248/laser/start", {
                method: "POST"
            })

            if (response.ok) {
                infoHeader.innerText = "Laser start success"
            } else {
                infoHeader.innerText = "Laser start failed."
            }
        } catch (error) {
            infoHeader.innerText = "Fatal start error, consult console."
            console.log(error)
        }
    }

</script>

<body bgcolor="#111111" style="font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; color: azure;">
    
    <div id="informationDiv">Loading...</div>
    
    <center><h1>WebCommunication test</h1></center>

    <div> <!-- Button div -->
        <button onclick="sendPing()">Send Ping</button>
        <button onclick="startLaser()">Start Laserpointer</button>
        <button onclick="">Stop Laserpointer</button>
    </div>
    
    <br><br><br>
    <center><h3>Laser-Touchpad</h3></center>
    <div id="laser-touchpad"></div>


     
</body>

<script>

    document.addEventListener("DOMContentLoaded", function(){
        const infoHeader = document.getElementById("informationDiv")
        const touchpad = document.getElementById("laser-touchpad")

        infoHeader.innerText = "Fully loaded."

        // Touchpad

        touchpad.addEventListener("mousedown", () => {

            console.log("mouse down")

            let isdrag = false
            let haschanged = false
            let movelistener
            infoHeader.innerText = "drag start"

            function dragEvent(ev) {
                
                if (haschanged == false) {haschanged = true; isdrag = true}
                if (!isdrag) {
                    infoHeader.innerText = "Drag finished"
                    touchpad.removeEventListener("mousemove", dragEvent)
                    return
                }

                offsetX = ev.offsetX/touchpad.offsetWidth
                offsetY = ev.offsetY/touchpad.offsetHeight
                infoHeader.innerText = isdrag + " " + haschanged + "| x: " + offsetX + " y: " + offsetY
                
                if (!successfulPing) {
                    infoHeader.innerText = "Touchpad Update will only work if one successful ping has been send."
                } else 
                try {
                    fetch("http://127.0.0.1:15248/laser/update", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ x: offsetX, y: offsetY })
                    })
                } catch (error) {
                    error(error)
                }
            }

            touchpad.addEventListener("mousemove", dragEvent)

            touchpad.addEventListener("mouseup", (ev) => {
                if (haschanged && isdrag) {isdrag = false}
                console.log("up")
                return
            })
        })
    })

    


</script>
</html>